window.BackendCalendarGoogleSync=window.BackendCalendarGoogleSync||{},function(){"use strict";function e(){$("#enable-sync").on("click",function(){var n,l,o,e;!1===$("#enable-sync").hasClass("enabled")?(e=GlobalVariables.baseUrl+"/index.php/google/oauth/"+$("#select-filter-item").val(),n=GlobalVariables.baseUrl+"/index.php/google/oauth_callback",l=window.open(e,"Authorize Easy!Appointments","width=800, height=600"),o=window.setInterval(function(){try{var e,a;l.document&&-1!==l.document.URL.indexOf(n)&&(l.close(),window.clearInterval(o),$("#enable-sync").addClass("btn-secondary enabled").removeClass("btn-light"),$("#enable-sync span").text(EALang.disable_sync),$("#google-sync").prop("disabled",!1),$("#select-filter-item option:selected").attr("google-sync","true"),e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_google_calendars",a={csrfToken:GlobalVariables.csrfToken,provider_id:$("#select-filter-item").val()},$.post(e,a).done(function(e){$("#google-calendar").empty(),e.forEach(function(e){$("#google-calendar").append(new Option(e.summary,e.id))}),$("#select-google-calendar").modal("show")}))}catch(e){}},100)):(e=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){var e,a=$("#select-filter-item").val(),n=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(a)});if(!n)throw new Error("Provider not found: "+a);n.settings.google_sync="0",n.settings.google_token=null,e=n.id,n=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_disable_provider_sync",e={csrfToken:GlobalVariables.csrfToken,provider_id:e},$.post(n,e),$("#enable-sync").removeClass("btn-secondary enabled").addClass("btn-light"),$("#enable-sync span").text(EALang.enable_sync),$("#google-sync").prop("disabled",!0),$("#select-filter-item option:selected").attr("google-sync","false"),$("#message-box").dialog("close")}}],GeneralFunctions.displayMessageBox(EALang.disable_sync,EALang.disable_sync_prompt,e))}),$("#select-calendar").on("click",function(){var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_select_google_calendar",a={csrfToken:GlobalVariables.csrfToken,provider_id:$("#select-filter-item").val(),calendar_id:$("#google-calendar").val()};$.post(e,a).done(function(){Backend.displayNotification(EALang.google_calendar_selected),$("#select-google-calendar").modal("hide")})}),$("#google-sync").on("click",function(){var e=GlobalVariables.baseUrl+"/index.php/google/sync/"+$("#select-filter-item").val();$.ajax({url:e,type:"GET",dataType:"json"}).done(function(e){Backend.displayNotification(EALang.google_sync_completed),$("#reload-appointments").trigger("click")}).fail(function(e,a,n){Backend.displayNotification(EALang.google_sync_failed)})})}window.BackendCalendarGoogleSync.initialize=function(){e()}}();