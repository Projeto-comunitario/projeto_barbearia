window.BackendCalendarTableView=window.BackendCalendarTableView||{},function(){"use strict";var d,o,l;function e(){var e=$("#calendar-toolbar"),a=$("#calendar");a.on("click",".calendar-header .btn.previous",function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),a=moment(a).subtract(1,"days"),e=a.clone().add(e-1,"days");$(".select-date").datepicker("setDate",a.toDate()),r(a.toDate(),e.toDate())}),a.on("click",".calendar-header .btn.next",function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),a=moment(a).add(1,"days"),e=a.clone().add(e-1,"days");$(".select-date").datepicker("setDate",a.toDate()),r(a.toDate(),e.toDate())}),e.on("change","#select-filter-item",function(){var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),a=moment(a),e=a.clone().add(e-1,"days");r(a.toDate(),e.toDate())}),e.on("click","#reload-appointments",function(){$(".calendar-view .event").remove();var e=$("#select-filter-item").val(),a=$(".select-date").datepicker("getDate"),a=moment(a),n=a.toDate(),r=a.clone().add(e-1,"days").toDate();h(n,r).done(function(i){for(var t=n;t<=r;)$(".calendar-view .date-column").each(function(e,a){var a=$(a),r=new Date(a.data("date"));if(t.getTime()!==r.getTime())return!0;a.find(".date-column-title").text(GeneralFunctions.formatDate(r,GlobalVariables.dateFormat)),a.find(".provider-column").each(function(e,a){var t=$(a),n=t.data("provider");t.find(".calendar-wrapper").fullCalendar("removeEvents"),p(t.find(".calendar-wrapper"),t.data("provider")),u(t,i.appointments),b(t,i.unavailability_events);a=JSON.parse(n.settings.working_plan),n=r.toString("dddd").toLowerCase();a[n]&&function(e,a){if(0!==a.length){var t,n=new Date(e.parents(".date-column").data("date")),r=e.find("table tbody");for(t in a){var i=a[t],s=i.start.split(":"),d=new Date(n.getFullYear(),n.getMonth(),n.getDate(),s[0],s[1]),s=i.end.split(":"),s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),s[0],s[1]),s=Math.round((s-d)/6e4),o=$("<div/>",{class:"event unavailability break"});o.html(EALang.break+' <span class="hour">'+d.toString("HH:mm")+"</span> ("+s+"')"),o.data(i),r.find("tr").each(function(e,a){var t=$(a).find("td:first"),t=new Date(n.getTime()).set({hour:parseInt(t.text().split(":")[0]),minute:parseInt(t.text().split(":")[1])});if(d<t)return d.toString("HH:mm")===$(a).prev().find("td").eq(0).text()&&o.find(".hour").remove(),$(a).prev().find("td:gt(0)").each(function(e,a){o.clone().appendTo($(a))}),!1})}}}(t,a[n].breaks)})}),t.add({days:1});Backend.placeFooterToBottom()})}),$(window).on("resize",function(){y()}),a.on("click",".close-popover",function(){$(this).parents(".popover").popover("dispose")}),a.on("click",".edit-popover",function(){var e,i,a,t,n,r,s;$(this).parents(".popover").popover("dispose"),l.data.workingPlanException?(e=l.data.date,a=l.data.workingPlanException,i=l.data.provider,WorkingPlanExceptionsModal.edit(e,a).done(function(n,r){BackendCalendarApi.saveWorkingPlanException(n,r,i.id,function(){Backend.displayNotification(EALang.working_plan_exception_saved);var e,a=JSON.parse(i.settings.working_plan_exceptions)||{};for(e in a[n]=r,GlobalVariables.availableProviders){var t=GlobalVariables.availableProviders[e];if(Number(t.id)===Number(i.id)){t.settings.working_plan_exceptions=JSON.stringify(a);break}}$("#select-filter-item").trigger("change")},null)})):("0"===l.data.is_unavailable?(a=l.data,t=$("#manage-appointment"),BackendCalendarAppointmentsModal.resetAppointmentDialog(),t.find(".modal-header h3").text(EALang.edit_appointment_title),t.find("#appointment-id").val(a.id),t.find("#select-service").val(a.id_services).trigger("change"),t.find("#select-provider").val(a.id_users_provider),r=Date.parseExact(a.start_datetime,"yyyy-MM-dd HH:mm:ss"),t.find("#start-datetime").datetimepicker("setDate",r),s=Date.parseExact(a.end_datetime,"yyyy-MM-dd HH:mm:ss"),t.find("#end-datetime").datetimepicker("setDate",s),n=a.customer,t.find("#customer-id").val(a.id_users_customer),t.find("#first-name").val(n.first_name),t.find("#last-name").val(n.last_name),t.find("#email").val(n.email),t.find("#phone-number").val(n.phone_number),t.find("#address").val(n.address),t.find("#city").val(n.city),t.find("#zip-code").val(n.zip_code),t.find("#appointment-location").val(a.location),t.find("#appointment-notes").val(a.notes),t.find("#customer-notes").val(n.notes)):((n=l.data).start_datetime=l.start.format("YYYY-MM-DD HH:mm:ss"),r=Date.parseExact(n.start_datetime,"yyyy-MM-dd HH:mm:ss"),n.end_datetime=l.end.format("YYYY-MM-DD HH:mm:ss"),s=Date.parseExact(n.end_datetime,"yyyy-MM-dd HH:mm:ss"),t=$("#manage-unavailable"),BackendCalendarUnavailabilityEventsModal.resetUnavailableDialog(),t.find(".modal-header h3").text("Edit Unavailable Period"),t.find("#unavailable-start").datetimepicker("setDate",r),t.find("#unavailable-id").val(n.id),t.find("#unavailable-provider").val(n.id_users_provider),t.find("#unavailable-end").datetimepicker("setDate",s),t.find("#unavailable-notes").val(n.notes)),t.modal("show"))}),a.on("click",".delete-popover",function(){var e,a,t;$(this).parents(".popover").popover("dispose"),l.data.workingPlanException?(e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_working_plan_exception",a={csrfToken:GlobalVariables.csrfToken,working_plan_exception:l.start.format("YYYY-MM-DD"),provider_id:l.data.provider.id},$.post(e,a).done(function(){$("#message-box").dialog("close");var e=JSON.parse(l.data.provider.settings.working_plan_exceptions);delete e[l.start.format("YYYY-MM-DD")],l.data.provider.settings.working_plan_exceptions=JSON.stringify(e),$("#select-filter-item").trigger("change")})):"0"===l.data.is_unavailable?(t=[{text:EALang.cancel,click:function(){$("#message-box").dialog("close")}},{text:"OK",click:function(){e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_id:l.data.id,delete_reason:$("#delete-reason").val()},$.post(e,a).done(function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")})}}],GeneralFunctions.displayMessageBox(EALang.delete_appointment_title,EALang.write_appointment_removal_reason,t),$("<textarea/>",{class:"form-control w-100",id:"delete-reason",rows:"3"}).appendTo("#message-box")):(e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_delete_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable_id:l.data.id},$.post(e,a).done(function(){$("#message-box").dialog("close"),$("#select-filter-item").trigger("change")}))})}function r(t,n){$("#calendar .calendar-header .btn").addClass("disabled").prop("disabled",!0);var r={};$(".provider-column").each(function(e,a){var t=$(a),a=t.data("provider").id;r[a]=t.find(".calendar-wrapper").fullCalendar("getView").name}),$("#calendar .calendar-view").remove(),Backend.placeFooterToBottom();var e=$("<div/>",{class:"calendar-view"}).appendTo("#calendar");e.data({startDate:t.toString("yyyy-MM-dd"),endDate:n.toString("yyyy-MM-dd")});var i=$("<div/>").appendTo(e);h(t,n).done(function(e){for(var a=t;a<=n;)!function(e,r,i){var s=$("<div/>",{class:"date-column"}).appendTo(e);s.data("date",r.getTime()),$("<h5/>",{class:"date-column-title",text:GeneralFunctions.formatDate(r,GlobalVariables.dateFormat)}).appendTo(s);var t=d.val(),n=o.val(),a=GlobalVariables.availableProviders.filter(function(e){var a=e.services.filter(function(a){return n.filter(function(e){return Number(a)===Number(e)}).length});return!t.length&&!n.length||t.length&&!n.length&&-1!==t.indexOf(e.id)||!t.length&&n.length&&a.length||t.length&&n.length&&a.length&&-1!==t.indexOf(e.id)});"provider"===GlobalVariables.user.role_slug&&GlobalVariables.availableProviders.forEach(function(e){Number(e.id)===Number(GlobalVariables.user.id)&&(a=[e])});"secretary"===GlobalVariables.user.role_slug&&(a=[],GlobalVariables.availableProviders.forEach(function(e){-1<GlobalVariables.secretaryProviders.indexOf(e.id)&&a.push(e)}));a.forEach(function(e){var a,t,n;a=s,t=r,n=i,0!==(e=e).services.length&&((a=$("<div/>",{class:"provider-column"}).appendTo(a)).data("provider",e),function(e,a,t){var n=$("<div/>",{class:"calendar-wrapper"}).appendTo(e),r="";switch(GlobalVariables.dateFormat){case"DMY":r="ddd D/M";break;case"MDY":case"YMD":r="ddd M/D";break;default:throw new Error("Invalid date format setting provided!",GlobalVariables.dateFormat)}var i="",s="";switch(GlobalVariables.timeFormat){case"military":i="H:mm",s="H(:mm)";break;case"regular":i="h:mm a",s="h(:mm) a";break;default:throw new Error("Invalid time format setting provided!"+GlobalVariables.timeFormat)}var d=GlobalVariables.firstWeekday,d=GeneralFunctions.getWeekDayId(d);n.fullCalendar({defaultView:"agendaDay",height:c(),editable:!0,timeFormat:i,slotLabelFormat:s,allDaySlot:!0,columnFormat:r,firstDay:d,snapDuration:"00:15:00",header:{left:"listDay,agendaDay",center:"",right:""},selectable:!0,selectHelper:!0,select:function(e,a,t){if(e.hasTime()&&a.hasTime()){$("#insert-appointment").trigger("click");var n=$(t.target).parents(".provider-column").data("provider").id,r=GlobalVariables.availableProviders.find(function(e){return Number(e.id)===Number(n)}),t=GlobalVariables.availableServices.find(function(e){return-1!==r.services.indexOf(e.id)});return t&&$("#select-service").val(t.id),$("#select-service").val()||$("#select-service option:first").prop("selected",!0),$("#select-service").trigger("change"),r&&$("#select-provider").val(r.id),$("#select-provider").val()||$("#select-provider option:first").prop("selected",!0),$("#select-provider").trigger("change"),$("#start-datetime").datepicker("setDate",new Date(e.format("YYYY/MM/DD HH:mm:ss"))),$("#end-datetime").datepicker("setDate",new Date(a.format("YYYY/MM/DD HH:mm:ss"))),!1}},monthNames:[EALang.january,EALang.february,EALang.march,EALang.april,EALang.may,EALang.june,EALang.july,EALang.august,EALang.september,EALang.october,EALang.november,EALang.december],monthNamesShort:[EALang.january.substr(0,3),EALang.february.substr(0,3),EALang.march.substr(0,3),EALang.april.substr(0,3),EALang.may.substr(0,3),EALang.june.substr(0,3),EALang.july.substr(0,3),EALang.august.substr(0,3),EALang.september.substr(0,3),EALang.october.substr(0,3),EALang.november.substr(0,3),EALang.december.substr(0,3)],dayNames:[EALang.sunday,EALang.monday,EALang.tuesday,EALang.wednesday,EALang.thursday,EALang.friday,EALang.saturday],dayNamesShort:[EALang.sunday.substr(0,3),EALang.monday.substr(0,3),EALang.tuesday.substr(0,3),EALang.wednesday.substr(0,3),EALang.thursday.substr(0,3),EALang.friday.substr(0,3),EALang.saturday.substr(0,3)],dayNamesMin:[EALang.sunday.substr(0,2),EALang.monday.substr(0,2),EALang.tuesday.substr(0,2),EALang.wednesday.substr(0,2),EALang.thursday.substr(0,2),EALang.friday.substr(0,2),EALang.saturday.substr(0,2)],buttonText:{today:EALang.today,day:EALang.day,week:EALang.week,month:EALang.month,agendaDay:EALang.calendar,listDay:EALang.list},eventClick:f,eventResize:v,eventDrop:g,viewRender:m}),n.fullCalendar("gotoDate",moment(a)),$("<h6/>",{text:t.first_name+" "+t.last_name}).prependTo(e)}(a,t,e),p(a.find(".calendar-wrapper"),e),u(a,n.appointments),b(a,n.unavailability_events),Backend.placeFooterToBottom())})}(i,a,e),a.add({days:1});y(),Backend.placeFooterToBottom(),$("#calendar .calendar-header .btn").removeClass("disabled").prop("disabled",!1),$(".provider-column").each(function(e,a){var t=$(a),a=t.data("provider").id;t.find(".calendar-wrapper").fullCalendar("changeView",r[a]||"agendaDay")})})}function c(){var e=window.innerHeight-$("#footer").outerHeight()-$("#header").outerHeight()-60;return 500<e?e:500}function m(e,a){$(a).fullCalendar("option","height",c())}function p(e,a){var t,n=JSON.parse(a.settings.working_plan),r=JSON.parse(a.settings.working_plan_exceptions)||{},i=e.fullCalendar("getView"),s=i.start.clone(),d=i.end.clone(),o=s.toDate().toString("dddd").toLowerCase(),l=s.format("YYYY-MM-DD"),c=[];if(r[l]&&(n[o]=r[l],t=l+" "+n[o].start,i=l+" "+n[o].end,a={title:EALang.working_plan_exception,start:moment(t,"YYYY-MM-DD HH:mm",!0),end:moment(i,"YYYY-MM-DD HH:mm",!0).add(1,"day"),allDay:!0,color:"#879DB4",editable:!1,className:"fc-working-plan-exception fc-custom",data:{date:l,workingPlanException:r[l],provider:a}},c.push(a)),null===n[o]){var m={title:EALang.not_working,start:s,end:d,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"};return c.push(m),void e.fullCalendar("addEventSource",c)}m=moment(s.toDate().toString("yyyy-MM-dd")+" "+n[o].start);s<m&&(p={title:EALang.not_working,start:s,end:m,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},c.push(p));var p,u,b,m=moment(s.toDate().toString("yyyy-MM-dd")+" "+n[o].end);m<d&&(p={title:EALang.not_working,start:m,end:d,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable"},c.push(p)),n[o].breaks.forEach(function(e){u=moment(s.toDate().toString("yyyy-MM-dd")+" "+e.start),b=moment(s.toDate().toString("yyyy-MM-dd")+" "+e.end);e={title:EALang.break,start:u,end:b,allDay:!1,color:"#BEBEBE",editable:!1,className:"fc-unavailable fc-break"};c.push(e)}),e.fullCalendar("addEventSource",c)}function u(e,a){if(0!==a.length){var t,n=o.val(),r=[];for(t in a=a.filter(function(e){return!n.length||-1!==n.indexOf(e.id_services)})){var i=a[t];i.id_users_provider===e.data("provider").id&&r.push({id:i.id,title:i.service.name+" - "+i.customer.first_name+" "+i.customer.last_name,start:moment(i.start_datetime),end:moment(i.end_datetime),allDay:!1,data:i})}e.find(".calendar-wrapper").fullCalendar("addEventSource",r)}}function b(e,a){if(0!==a.length){var t,n=[];for(t in a){var r=a[t];r.id_users_provider===e.data("provider").id&&(r={title:EALang.unavailable,start:moment(r.start_datetime),end:moment(r.end_datetime),allDay:!1,color:"#879DB4",editable:!0,className:"fc-unavailable fc-custom",data:r},n.push(r))}e.find(".calendar-wrapper").fullCalendar("addEventSource",n)}}function s(e){if(!e.data||!e.data.notes)return"-";e=e.data.notes;return 100<e.length?e.substring(0,100)+"...":e}function f(e,a){var t;$(".popover").popover("dispose");var n=$(a.target.offsetParent),r=$(a.target).parents().eq(1),i=$(this).hasClass("fc-unavailable")||n.hasClass("fc-unavailable")||r.hasClass("fc-unavailable")?(i=(n.hasClass("fc-custom")||r.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",t=(n.hasClass("fc-custom")||r.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none",$("<div/>",{html:[$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:s(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+t,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})):$(this).hasClass("fc-working-plan-exception")||n.hasClass("fc-working-plan-exception")||r.hasClass("fc-working-plan-exception")?(i=(n.hasClass("fc-custom")||r.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",t=(n.hasClass("fc-custom")||r.hasClass("fc-custom"))&&!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none",$("<div/>",{html:[$("<strong/>",{text:EALang.provider}),$("<span/>",{text:e.data?e.data.provider.first_name+" "+e.data.provider.last_name:"-"}),$("<br/>"),$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.start,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.data.date+" "+e.data.workingPlanException.end,GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+t,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]})):(i=!0===GlobalVariables.user.privileges.appointments.edit?"":"d-none",t=!0===GlobalVariables.user.privileges.appointments.delete?"":"d-none",$("<div/>",{html:[$("<strong/>",{text:EALang.start}),$("<span/>",{text:GeneralFunctions.formatDate(e.start.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.end}),$("<span/>",{text:GeneralFunctions.formatDate(e.end.format("YYYY-MM-DD HH:mm:ss"),GlobalVariables.dateFormat,!0)}),$("<br/>"),$("<strong/>",{text:EALang.timezone}),$("<span/>",{text:GlobalVariables.timezones[e.data.provider.timezone]}),$("<br/>"),$("<strong/>",{text:EALang.service}),$("<span/>",{text:e.data.service.name}),$("<br/>"),$("<strong/>",{text:EALang.provider}),GeneralFunctions.renderMapIcon(e.data.provider),$("<span/>",{text:e.data.provider.first_name+" "+e.data.provider.last_name}),$("<br/>"),$("<strong/>",{text:EALang.customer}),GeneralFunctions.renderMapIcon(e.data.customer),$("<span/>",{text:e.data.customer.first_name+" "+e.data.customer.last_name}),$("<br/>"),$("<strong/>",{text:EALang.email}),GeneralFunctions.renderMailIcon(e.data.customer.email),$("<span/>",{text:e.data.customer.email}),$("<br/>"),$("<strong/>",{text:EALang.phone}),GeneralFunctions.renderPhoneIcon(e.data.customer.phone_number),$("<span/>",{text:e.data.customer.phone_number}),$("<br/>"),$("<strong/>",{text:EALang.notes}),$("<span/>",{text:s(e)}),$("<br/>"),$("<hr/>"),$("<div/>",{class:"d-flex justify-content-center",html:[$("<button/>",{class:"close-popover btn btn-outline-secondary mr-2",html:[$("<i/>",{class:"fas fa-ban mr-2"}),$("<span/>",{text:EALang.close})]}),$("<button/>",{class:"delete-popover btn btn-outline-secondary mr-2 "+t,html:[$("<i/>",{class:"fas fa-trash-alt mr-2"}),$("<span/>",{text:EALang.delete})]}),$("<button/>",{class:"edit-popover btn btn-primary "+i,html:[$("<i/>",{class:"fas fa-edit mr-2"}),$("<span/>",{text:EALang.edit})]})]})]}));$(a.target).popover({placement:"top",title:e.title,content:i,html:!0,container:"#calendar",trigger:"manual"}),l=e,$(a.target).popover("toggle"),0<$(".popover").length&&$(".popover").position().top<200&&$(".popover").css("top","200px")}function v(t,n,r){if(!1===GlobalVariables.user.privileges.appointments.edit)return r(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var e,i,s,a=$("#calendar");$("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===t.data.is_unavailable?(t.data.end_datetime=Date.parseExact(t.data.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),delete(i=GeneralFunctions.clone(t.data)).customer,delete i.provider,delete i.service,e=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.end_datetime=t.data.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(e,a).done(function(){$("#notification").hide("blind")}),r()}}]),$("#footer").css("position","static"),a.fullCalendar("updateEvent",t)},BackendCalendarApi.saveAppointment(i,null,e)):(s={id:t.data.id,start_datetime:t.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:t.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:t.data.id_users_provider},t.data.end_datetime=s.end_datetime,e=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){s.end_datetime=t.data.end_datetime=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss").add({minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss");var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(s)};$.post(e,a).done(function(){$("#notification").hide("blind")}),r()}}]),$("#footer").css("position","static"),a.fullCalendar("updateEvent",t)},BackendCalendarApi.saveUnavailable(s,e))}function g(t,n,r){if(!1===GlobalVariables.user.privileges.appointments.edit)return r(),void Backend.displayNotification(EALang.no_privileges_edit_appointments);var i,s,e;$("#notification").is(":visible")&&$("#notification").hide("bind"),"0"===t.data.is_unavailable?(delete(i=GeneralFunctions.clone(t.data)).customer,delete i.provider,delete i.service,i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:n.days(),hours:n.hours(),minutes:n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=i.start_datetime,t.data.end_datetime=i.end_datetime,e=function(){Backend.displayNotification(EALang.appointment_updated,[{label:EALang.undo,function:function(){i.start_datetime=Date.parseExact(i.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),i.end_datetime=Date.parseExact(i.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),hours:-n.hours(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=i.start_datetime,t.data.end_datetime=i.end_datetime;var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_appointment",a={csrfToken:GlobalVariables.csrfToken,appointment_data:JSON.stringify(i)};$.post(e,a).done(function(){$("#notification").hide("blind")}),r()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveAppointment(i,null,e)):(s={id:t.data.id,start_datetime:t.start.format("YYYY-MM-DD HH:mm:ss"),end_datetime:t.end.format("YYYY-MM-DD HH:mm:ss"),id_users_provider:t.data.id_users_provider},e=function(){Backend.displayNotification(EALang.unavailable_updated,[{label:EALang.undo,function:function(){s.start_datetime=Date.parseExact(s.start_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),s.end_datetime=Date.parseExact(s.end_datetime,"yyyy-MM-dd HH:mm:ss").add({days:-n.days(),minutes:-n.minutes()}).toString("yyyy-MM-dd HH:mm:ss"),t.data.start_datetime=s.start_datetime,t.data.end_datetime=s.end_datetime;var e=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_save_unavailable",a={csrfToken:GlobalVariables.csrfToken,unavailable:JSON.stringify(s)};$.post(e,a).done(function(){$("#notification").hide("blind")}),r()}}]),$("#footer").css("position","static")},BackendCalendarApi.saveUnavailable(s,e))}function y(){var e=window.innerHeight-$("#header").outerHeight()-$("#footer").outerHeight()-$("#calendar-toolbar").outerHeight()-$(".calendar-header").outerHeight()-50;e<500&&(e=500);var a=$(".date-column"),t=$(".calendar-view > div");t.css("min-width","1000%");var n=0;a.each(function(e,a){n+=$(a).outerWidth()}),t.css("min-width",n+200);a=a.outerHeight();$(".calendar-view .not-working").outerHeight((e<a?a:e)-70)}function h(e,a){var t=GlobalVariables.baseUrl+"/index.php/backend_api/ajax_get_calendar_events",a={csrfToken:GlobalVariables.csrfToken,startDate:e.toString("yyyy-MM-dd"),endDate:a.toString("yyyy-MM-dd")};return $.ajax({url:t,data:a,method:"POST",beforeSend:function(){},complete:function(){}})}window.BackendCalendarTableView.initialize=function(){!function(){$("#calendar-filter").find("select").empty().append(new Option("1 "+EALang.day,1)).append(new Option("3 "+EALang.days,3));var e,a=$("<div/>",{class:"calendar-header"}).appendTo("#calendar");switch($("<button/>",{class:"btn btn-xs btn-outline-secondary previous mr-2",html:[$("<span/>",{class:"fas fa-chevron-left"})]}).appendTo(a),$("<input/>",{type:"text",class:"form-control d-inline-block select-date mr-2",value:GeneralFunctions.formatDate(new Date,GlobalVariables.dateFormat,!1)}).appendTo(a),$("<button/>",{class:"btn btn-xs btn-outline-secondary next",html:[$("<span/>",{class:"fas fa-chevron-right"})]}).appendTo(a),GlobalVariables.dateFormat){case"DMY":e="dd/mm/yy";break;case"MDY":e="mm/dd/yy";break;case"YMD":e="yy/mm/dd";break;default:throw new Error("Invalid date format setting provided: "+GlobalVariables.dateFormat)}a.find(".select-date").datepicker({defaultDate:new Date,dateFormat:e,onSelect:function(e,a){var t=new Date(a.currentYear,a.currentMonth,a.currentDay),a=new Date(t.getTime()).add({days:parseInt($("#select-filter-item").val())-1});r(t,a)}});var t=GlobalVariables.availableProviders.filter(function(e){return GlobalVariables.user.role_slug===Backend.DB_SLUG_ADMIN||GlobalVariables.user.role_slug===Backend.DB_SLUG_SECRETARY&&-1!==GlobalVariables.secretaryProviders.indexOf(e.id)||GlobalVariables.user.role_slug===Backend.DB_SLUG_PROVIDER&&Number(e.id)===Number(GlobalVariables.user.id)});$("<label/>",{text:EALang.provider}).appendTo(a),d=$("<select/>",{id:"filter-provider",multiple:"multiple",on:{change:function(){var e=new Date($(".calendar-view .date-column:first").data("date")),a=new Date(e.getTime()).add({days:parseInt($("#select-date").val())-1});r(e,a)}}}).appendTo(a),GlobalVariables.user.role_slug!==Backend.DB_SLUG_PROVIDER?t.forEach(function(e){d.append(new Option(e.first_name+" "+e.last_name,e.id))}):t.forEach(function(e){Number(e.id)===Number(GlobalVariables.user.id)&&d.append(new Option(e.first_name+" "+e.last_name,e.id))}),d.select2();var n=GlobalVariables.availableServices.filter(function(a){var e=t.find(function(e){return-1!==e.services.indexOf(a.id)});return GlobalVariables.user.role_slug===Backend.DB_SLUG_ADMIN||e});$("<label/>",{text:EALang.service}).appendTo(a),o=$("<select/>",{id:"filter-service",multiple:"multiple",on:{change:function(){var e=new Date($(".calendar-view .date-column:first").data("date")),a=new Date(e.getTime()).add({days:parseInt($("#select-date").val())-1});r(e,a)}}}).appendTo(a),n.forEach(function(e){o.append(new Option(e.name,e.id))}),o.select2()}(),r(moment().toDate(),moment().add(Number($("#select-filter-item").val())-1,"days").toDate()),$("#insert-working-plan-exception").hide(),e(),$("#enable-sync, #google-sync").hide()}}();